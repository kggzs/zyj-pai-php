# VIP会员功能说明

本文档详细列出了系统中所有VIP会员的特权和功能。

## 📋 目录

1. [拍摄链接管理](#拍摄链接管理)
2. [签到系统](#签到系统)
3. [批量操作](#批量操作)
4. [积分商城](#积分商城)
5. [VIP状态管理](#vip状态管理)
6. [功能对比表](#功能对比表)

---

## 1. 拍摄链接管理

### 1.1 无限制生成拍摄链接

**VIP特权：**
- ✅ VIP用户可无限制生成拍摄链接
- ✅ 不受数量限制

**普通用户限制：**
- ❌ 普通用户最多可生成7个拍摄链接（基础配额）
- ❌ 可通过积分商城兑换额外配额
- ❌ 达到上限后无法继续生成

**实现位置：**
- `core/Invite.php` - `generateInvite()` 方法
- `assets/js/dashboard.js` - 拍摄链接列表显示

### 1.2 永久有效链接

**VIP特权：**
- ✅ VIP用户默认生成永久有效的拍摄链接
- ✅ 链接的 `expire_time` 字段为 `NULL`（表示无限制）
- ✅ 链接不会自动过期

**普通用户限制：**
- ❌ 普通用户生成的链接有默认有效期（默认7天）
- ❌ 链接到期后自动失效
- ❌ 无法设置永久有效

**实现位置：**
- `core/Invite.php` - `generateInvite()` 方法（第102-123行）
- 系统配置：`invite.default_expire_days`

### 1.3 拍摄链接编辑功能

**VIP特权：**
- ✅ VIP用户可以编辑拍摄链接的标签（label）
- ✅ VIP用户可以启用/禁用拍摄链接
- ✅ 可以修改链接状态

**普通用户限制：**
- ❌ 普通用户无法编辑拍摄链接
- ❌ 只能查看和使用链接

**实现位置：**
- `api/update_invite.php` - 更新拍摄链接API
- `assets/js/dashboard.js` - 编辑链接模态框（仅VIP用户显示）

---

## 2. 签到系统

### 2.1 VIP签到额外奖励

**VIP特权：**
- ✅ VIP用户签到获得额外积分奖励
- ✅ 默认额外奖励：**+3分**（可配置）
- ✅ 奖励会在积分明细中标注"VIP额外奖励"

**普通用户：**
- ❌ 只有基础签到奖励（默认5分）
- ❌ 无额外奖励

**实现位置：**
- `core/Points.php` - `doCheckin()` 方法（第192-197行）
- 系统配置：`points.checkin_vip_bonus`

**示例：**
```
普通用户签到：基础5分
VIP用户签到：基础5分 + VIP额外3分 = 总共8分
```

### 2.2 VIP连续签到奖励

**VIP特权：**
- ✅ VIP用户连续签到获得更高的额外奖励
- ✅ 奖励阶梯更优厚

**VIP连续签到奖励配置（默认）：**
- 连续3天：**+8分**
- 连续7天：**+15分**
- 连续15天：**+30分**
- 连续30天：**+80分**

**普通用户连续签到奖励（默认）：**
- 连续3天：+5分
- 连续7天：+10分
- 连续15天：+20分
- 连续30天：+50分

**实现位置：**
- `core/Points.php` - `doCheckin()` 方法（第199-215行）
- 系统配置：`points.checkin_vip_consecutive_bonus`

**示例：**
```
普通用户连续签到30天：基础5分 + 连续奖励50分 = 总共55分
VIP用户连续签到30天：基础5分 + VIP额外3分 + 连续奖励80分 = 总共88分
```

---

## 3. 批量操作

### 3.1 批量下载照片

**VIP特权：**
- ✅ VIP用户可以批量下载照片
- ✅ 支持ZIP格式打包下载
- ✅ 一次最多可下载100张照片
- ✅ 支持照片和视频混合下载

**普通用户限制：**
- ❌ 普通用户只能单张下载
- ❌ 无法批量下载

**实现位置：**
- `api/batch_download_photos.php` - 批量下载API
- 前端：照片列表页面的批量下载按钮（仅VIP用户显示）

**使用方式：**
1. 在照片列表中选择多张照片
2. 点击"批量下载"按钮
3. 系统自动打包为ZIP文件下载

### 3.2 批量删除照片

**VIP特权：**
- ✅ VIP用户可以批量删除照片
- ✅ 支持一次性删除多张照片
- ✅ 使用软删除机制（可恢复）

**普通用户限制：**
- ❌ 普通用户只能单张删除
- ❌ 无法批量删除

**实现位置：**
- `api/batch_delete_photos.php` - 批量删除API
- `core/Photo.php` - `batchSoftDeletePhotos()` 方法
- 前端：照片列表页面的批量删除按钮（仅VIP用户显示）

**使用方式：**
1. 在照片列表中选择多张照片
2. 点击"批量删除"按钮
3. 确认删除操作

---

## 4. 积分商城

### 4.1 兑换VIP会员

**VIP特权：**
- ✅ VIP用户可用积分兑换VIP会员
- ✅ 支持兑换临时VIP（指定天数）
- ✅ 支持兑换永久VIP
- ✅ 如果已有VIP且未过期，兑换临时VIP会延长到期时间

**普通用户：**
- ✅ 普通用户也可用积分兑换VIP会员
- ✅ 兑换后立即享受VIP特权

**实现位置：**
- `core/Shop.php` - `exchangeProduct()` 方法（第272-306行）
- 商品类型：
  - `vip_temporary` - 临时VIP（需要指定天数）
  - `vip_permanent` - 永久VIP

**兑换规则：**
- 临时VIP：根据商品配置的天数，从当前时间或到期时间延长
- 永久VIP：设置 `vip_expire_time` 为 `NULL`

---

## 5. VIP状态管理

### 5.1 VIP到期时间

**VIP类型：**
- **临时VIP**：设置具体的到期时间（`vip_expire_time` 为具体日期时间）
- **永久VIP**：`vip_expire_time` 为 `NULL`，表示永久有效

**实现位置：**
- 数据库字段：`users.vip_expire_time` (DATETIME NULL)
- `api/admin/set_vip.php` - 管理员设置VIP

### 5.2 自动过期检测

**系统功能：**
- ✅ 系统自动检测VIP是否过期
- ✅ 过期后自动更新用户状态（`is_vip = 0`）
- ✅ 在多个API中都有过期检测逻辑

**检测位置：**
- `api/get_invites.php` - 获取拍摄链接列表时检测
- `api/do_checkin.php` - 签到时检测
- `api/check_active_invite.php` - 检查活动链接时检测
- `core/Invite.php` - 生成链接时检测

**检测逻辑：**
```php
if ($user['vip_expire_time'] === null) {
    // 永久VIP
    $isVip = true;
} else {
    // 检查是否过期
    $expireTime = strtotime($user['vip_expire_time']);
    $isVip = $expireTime > time();
    
    // 如果过期，自动更新状态
    if (!$isVip) {
        $db->execute(
            "UPDATE users SET is_vip = 0, vip_expire_time = NULL WHERE id = ?",
            [$userId]
        );
    }
}
```

### 5.3 管理员设置VIP

**管理员功能：**
- ✅ 管理员可在后台设置用户VIP状态
- ✅ 可设置临时VIP（指定到期时间）
- ✅ 可设置永久VIP
- ✅ 可取消VIP状态

**实现位置：**
- `admin.php` - 用户管理页面
- `api/admin/set_vip.php` - 设置VIP API
- `assets/js/admin.js` - VIP设置模态框

---

## 6. 功能对比表

### 6.1 完整功能对比

| 功能类别 | 功能项 | VIP用户 | 普通用户 |
|---------|--------|---------|---------|
| **拍摄链接** | 生成数量限制 | ✅ 无限制 | ❌ 最多7个（可兑换增加） |
| | 链接有效期 | ✅ 默认永久有效 | ❌ 默认7天 |
| | 编辑链接（标签、状态） | ✅ 支持 | ❌ 不支持 |
| **签到系统** | 基础签到奖励 | ✅ 5分 | ✅ 5分 |
| | VIP额外奖励 | ✅ +3分 | ❌ 无 |
| | 连续3天奖励 | ✅ +8分 | ❌ +5分 |
| | 连续7天奖励 | ✅ +15分 | ❌ +10分 |
| | 连续15天奖励 | ✅ +30分 | ❌ +20分 |
| | 连续30天奖励 | ✅ +80分 | ❌ +50分 |
| **批量操作** | 批量下载照片 | ✅ 支持（最多100张） | ❌ 不支持 |
| | 批量删除照片 | ✅ 支持 | ❌ 不支持 |
| **积分商城** | 兑换VIP会员 | ✅ 支持 | ✅ 支持 |
| | 兑换拍摄链接配额 | ✅ 支持 | ✅ 支持 |

### 6.2 VIP特权总结

**核心特权：**
1. 🎯 **无限制拍摄链接** - 不受数量限制，可无限生成
2. ⏰ **永久有效链接** - 默认生成永久有效的拍摄链接
3. ✏️ **链接编辑功能** - 可编辑链接标签和状态
4. 💰 **签到额外奖励** - 每次签到额外获得3分
5. 🏆 **更高连续奖励** - 连续签到奖励更优厚
6. 📦 **批量下载** - 支持批量下载照片（ZIP打包）
7. 🗑️ **批量删除** - 支持批量删除照片

---

## 7. 技术实现

### 7.1 数据库字段

```sql
-- users表VIP相关字段
`is_vip` TINYINT(1) DEFAULT 0 COMMENT '是否VIP用户：1-是，0-否'
`vip_expire_time` DATETIME NULL COMMENT 'VIP到期时间（NULL表示永久VIP）'
```

### 7.2 核心代码文件

**VIP检测逻辑：**
- `core/Invite.php` - 拍摄链接生成和验证
- `core/Points.php` - 签到奖励计算
- `core/Photo.php` - 批量操作权限检查
- `core/Shop.php` - VIP兑换处理

**API接口：**
- `api/get_invites.php` - 获取拍摄链接列表（检测VIP）
- `api/do_checkin.php` - 签到（VIP额外奖励）
- `api/batch_download_photos.php` - 批量下载（VIP权限检查）
- `api/batch_delete_photos.php` - 批量删除（VIP权限检查）
- `api/admin/set_vip.php` - 管理员设置VIP

**前端文件：**
- `assets/js/dashboard.js` - 用户中心VIP功能显示
- `assets/js/admin.js` - 管理员VIP设置界面

### 7.3 系统配置

**签到配置（config.php 或数据库 system_config 表）：**
```php
'points' => [
    'checkin_reward' => 5,  // 基础签到奖励
    'checkin_vip_bonus' => 3,  // VIP额外奖励
    'checkin_vip_consecutive_bonus' => [
        '3' => 8,
        '7' => 15,
        '15' => 30,
        '30' => 80
    ]
]
```

**拍摄链接配置：**
```php
'invite' => [
    'max_count' => 7,  // 普通用户最大数量
    'default_expire_days' => 7  // 普通用户默认有效期
]
```

---

## 8. 使用说明

### 8.1 如何成为VIP

1. **管理员设置**：管理员在后台用户管理中直接设置VIP状态
2. **积分兑换**：在积分商城中使用积分兑换VIP会员
   - 临时VIP：兑换指定天数的VIP
   - 永久VIP：兑换永久VIP会员

### 8.2 VIP功能使用

1. **生成永久链接**：
   - VIP用户生成拍摄链接时，默认就是永久有效
   - 无需额外设置

2. **编辑链接**：
   - 在拍摄链接列表中，VIP用户可以看到"编辑"按钮
   - 点击编辑可以修改链接标签和状态

3. **批量操作**：
   - 在照片列表中选择多张照片
   - 点击"批量下载"或"批量删除"按钮
   - 确认操作即可

4. **签到奖励**：
   - VIP用户签到时会自动获得额外奖励
   - 连续签到天数越多，奖励越丰厚

---

## 9. 注意事项

1. **VIP过期**：系统会自动检测VIP是否过期，过期后自动取消VIP状态
2. **永久VIP**：永久VIP的 `vip_expire_time` 字段为 `NULL`
3. **批量下载限制**：一次最多下载100张照片，防止服务器资源消耗过大
4. **批量操作**：批量删除使用软删除机制，照片不会立即从服务器删除
5. **链接编辑**：只有VIP用户可以编辑链接，普通用户无法编辑

---

## 10. 更新日志

- **初始版本**：包含所有基础VIP功能
- **功能完善**：添加批量下载和批量删除功能
- **签到优化**：优化VIP签到奖励机制
- **链接编辑**：添加VIP用户链接编辑功能

---

**最后更新：** 2024年

**文档维护：** 系统管理员

