# ğŸ’° ç§¯åˆ†ç³»ç»Ÿæ¨¡å—

ç§¯åˆ†ç³»ç»Ÿæ¨¡å—è´Ÿè´£ç§¯åˆ†çš„è·å–ã€æ¶ˆè´¹ã€è®°å½•å’Œæ’è¡Œæ¦œç­‰åŠŸèƒ½ã€‚

## âœ¨ åŠŸèƒ½æ¦‚è¿°

### ğŸ 1. ç§¯åˆ†è·å–æ–¹å¼

#### æ³¨å†Œå¥–åŠ±
- æ–°ç”¨æˆ·æ³¨å†Œæ—¶è·å¾—åˆå§‹ç§¯åˆ†ï¼ˆé»˜è®¤10åˆ†ï¼Œå¯é…ç½®ï¼‰

#### é‚€è¯·å¥–åŠ±
- **é€šè¿‡æ³¨å†Œç æ³¨å†Œ**ï¼š
  - æ–°ç”¨æˆ·ä½¿ç”¨æ³¨å†Œç æ³¨å†Œï¼Œæ–°ç”¨æˆ·è·å¾—ç§¯åˆ†ï¼ˆé»˜è®¤5åˆ†ï¼‰
  - æ³¨å†Œç æ‹¥æœ‰è€…è·å¾—é‚€è¯·å¥–åŠ±ï¼ˆé»˜è®¤5åˆ†ï¼‰
- **é€šè¿‡æ‹æ‘„é“¾æ¥ç æ³¨å†Œ**ï¼š
  - æ–°ç”¨æˆ·ä½¿ç”¨æ‹æ‘„é“¾æ¥ç æ³¨å†Œï¼Œæ–°ç”¨æˆ·è·å¾—ç§¯åˆ†ï¼ˆé»˜è®¤5åˆ†ï¼‰
  - æ‹æ‘„é“¾æ¥ç æ‹¥æœ‰è€…è·å¾—é‚€è¯·å¥–åŠ±ï¼ˆé»˜è®¤5åˆ†ï¼‰

#### ä¸Šä¼ å¥–åŠ±
- é€šè¿‡æ‹æ‘„é“¾æ¥ä¸Šä¼ ç…§ç‰‡/è§†é¢‘è·å¾—ç§¯åˆ†ï¼ˆé»˜è®¤2åˆ†ï¼Œå¯é…ç½®ï¼‰

#### ç­¾åˆ°å¥–åŠ±
- **åŸºç¡€å¥–åŠ±**ï¼šæ¯æ—¥ç­¾åˆ°è·å¾—åŸºç¡€ç§¯åˆ†ï¼ˆé»˜è®¤5åˆ†ï¼‰
- **VIPé¢å¤–å¥–åŠ±**ï¼šVIPç”¨æˆ·ç­¾åˆ°é¢å¤–è·å¾—ç§¯åˆ†ï¼ˆé»˜è®¤3åˆ†ï¼‰
- **è¿ç»­ç­¾åˆ°å¥–åŠ±**ï¼š
  - æ™®é€šç”¨æˆ·ï¼šè¿ç»­3/7/15/30å¤©é¢å¤–å¥–åŠ±5/10/20/50åˆ†
  - VIPç”¨æˆ·ï¼šè¿ç»­3/7/15/30å¤©é¢å¤–å¥–åŠ±8/15/30/80åˆ†

### ğŸ’¸ 2. ç§¯åˆ†æ¶ˆè´¹

- åœ¨ç§¯åˆ†å•†åŸå…‘æ¢å•†å“ï¼ˆVIPã€æ‹æ‘„é“¾æ¥é…é¢ç­‰ï¼‰

### ğŸ“ 3. ç§¯åˆ†è®°å½•

æ‰€æœ‰ç§¯åˆ†å˜åŠ¨éƒ½ä¼šè®°å½•åˆ°`points_log`è¡¨ï¼ŒåŒ…æ‹¬ï¼š
- ç§¯åˆ†ç±»å‹ï¼ˆtypeï¼‰
- ç§¯åˆ†æ•°é‡ï¼ˆpointsï¼Œæ­£æ•°è¡¨ç¤ºå¢åŠ ï¼Œè´Ÿæ•°è¡¨ç¤ºå‡å°‘ï¼‰
- å¤‡æ³¨è¯´æ˜ï¼ˆremarkï¼‰
- å…³è”ç”¨æˆ·ï¼ˆnew_user_idï¼Œå¦‚é‚€è¯·å¥–åŠ±ï¼‰
- å…³è”ç ï¼ˆinvite_codeï¼Œæ³¨å†Œç æˆ–æ‹æ‘„é“¾æ¥ç ï¼‰
- åˆ›å»ºæ—¶é—´ï¼ˆcreate_timeï¼‰

### ğŸ† 4. ç§¯åˆ†æ’è¡Œæ¦œ

æ”¯æŒå››ç§æ’è¡Œæ¦œï¼š
- **æ€»ç§¯åˆ†æ’è¡Œæ¦œ**ï¼šæŒ‰ç”¨æˆ·æ€»ç§¯åˆ†æ’åº
- **æœˆåº¦ç§¯åˆ†æ’è¡Œæ¦œ**ï¼šæŒ‰æœ¬æœˆè·å¾—çš„ç§¯åˆ†æ’åº
- **é‚€è¯·äººæ•°æ’è¡Œæ¦œ**ï¼šæŒ‰é‚€è¯·æ–°ç”¨æˆ·æ•°é‡æ’åº
- **ä¸Šä¼ ç…§ç‰‡æ•°æ’è¡Œæ¦œ**ï¼šæŒ‰ä¸Šä¼ ç…§ç‰‡æ•°é‡æ’åº

## ğŸ”Œ APIæ¥å£

### è·å–ç§¯åˆ†ä¿¡æ¯

**æ¥å£**ï¼š`GET /api/get_points.php`

**æƒé™**ï¼šéœ€è¦ç™»å½•

**è¿”å›ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "points": 100,
  "points_log": {
    "list": [...],
    "total": 50,
    "page": 1,
    "page_size": 20
  }
}
```

### æ¯æ—¥ç­¾åˆ°

**æ¥å£**ï¼š`POST /api/do_checkin.php`

**æƒé™**ï¼šéœ€è¦ç™»å½•

**è¿”å›ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "message": "ç­¾åˆ°æˆåŠŸ",
  "data": {
    "points": 13,
    "base_points": 5,
    "vip_bonus": 3,
    "consecutive_bonus": 5,
    "consecutive_days": 3,
    "total_points": 113
  }
}
```

### æ£€æŸ¥ç­¾åˆ°çŠ¶æ€

**æ¥å£**ï¼š`GET /api/check_checkin_status.php`

**æƒé™**ï¼šéœ€è¦ç™»å½•

**è¿”å›ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "checked_in": false,
  "consecutive_days": 2
}
```

### è·å–ç­¾åˆ°å†å²

**æ¥å£**ï¼š`GET /api/get_checkin_history.php`

**æƒé™**ï¼šéœ€è¦ç™»å½•

**å‚æ•°**ï¼š
- `page`ï¼ˆå¯é€‰ï¼‰ï¼šé¡µç ï¼ˆé»˜è®¤1ï¼‰
- `page_size`ï¼ˆå¯é€‰ï¼‰ï¼šæ¯é¡µæ•°é‡ï¼ˆé»˜è®¤30ï¼‰

### è·å–æ’è¡Œæ¦œ

**æ¥å£**ï¼š`GET /api/get_ranking.php`

**å‚æ•°**ï¼š
- `type`ï¼ˆå¿…å¡«ï¼‰ï¼šæ’è¡Œæ¦œç±»å‹ï¼ˆ"total"ã€"month"ã€"invite"ã€"upload"ï¼‰
- `limit`ï¼ˆå¯é€‰ï¼‰ï¼šè¿”å›æ•°é‡ï¼ˆé»˜è®¤100ï¼‰

**è¿”å›ç¤ºä¾‹**ï¼š
```json
{
  "success": true,
  "ranking": [
    {
      "id": 1,
      "username": "user1",
      "nickname": "ç”¨æˆ·1",
      "points": 1000,
      "is_vip_active": true
    }
  ],
  "user_rank": {
    "rank": 5,
    "count": 800
  }
}
```

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„

### points_logè¡¨

ç§¯åˆ†å˜åŠ¨æ˜ç»†è¡¨ï¼š
- `id`ï¼šè®°å½•IDï¼ˆä¸»é”®ï¼‰
- `user_id`ï¼šç”¨æˆ·ID
- `type`ï¼šç§¯åˆ†ç±»å‹ï¼ˆ"register_reward"ã€"invite_reward"ã€"upload_reward"ã€"checkin_reward"ã€"shop_exchange"ç­‰ï¼‰
- `points`ï¼šç§¯åˆ†æ•°é‡ï¼ˆæ­£æ•°å¢åŠ ï¼Œè´Ÿæ•°å‡å°‘ï¼‰
- `remark`ï¼šå¤‡æ³¨è¯´æ˜
- `new_user_id`ï¼šå…³è”çš„æ–°ç”¨æˆ·IDï¼ˆå¦‚é‚€è¯·å¥–åŠ±ï¼‰
- `invite_code`ï¼šå…³è”ç ï¼ˆæ³¨å†Œç æˆ–æ‹æ‘„é“¾æ¥ç ï¼‰
- `create_time`ï¼šåˆ›å»ºæ—¶é—´

### checkinsè¡¨

ç­¾åˆ°è®°å½•è¡¨ï¼š
- `id`ï¼šè®°å½•IDï¼ˆä¸»é”®ï¼‰
- `user_id`ï¼šç”¨æˆ·ID
- `checkin_date`ï¼šç­¾åˆ°æ—¥æœŸ
- `consecutive_days`ï¼šè¿ç»­ç­¾åˆ°å¤©æ•°
- `points_earned`ï¼šè·å¾—çš„ç§¯åˆ†
- `created_at`ï¼šåˆ›å»ºæ—¶é—´

## ğŸ§° æ ¸å¿ƒç±»

### Pointsç±»

ä½ç½®ï¼š`core/Points.php`

ä¸»è¦æ–¹æ³•ï¼š
- `getUserPoints($userId)`ï¼šè·å–ç”¨æˆ·ç§¯åˆ†æ€»é¢
- `getPointsLog($userId, $page, $pageSize)`ï¼šè·å–ç§¯åˆ†å˜åŠ¨æ˜ç»†
- `addPoints($userId, $points, $type, $remark, $newUserId, $inviteCode)`ï¼šå¢åŠ ç§¯åˆ†
- `deductPoints($userId, $points, $type, $remark)`ï¼šæ‰£é™¤ç§¯åˆ†
- `doCheckin($userId, $isVip)`ï¼šæ‰§è¡Œç­¾åˆ°
- `checkCheckinStatus($userId)`ï¼šæ£€æŸ¥ç­¾åˆ°çŠ¶æ€
- `getCheckinHistory($userId, $page, $pageSize)`ï¼šè·å–ç­¾åˆ°å†å²
- `getTotalPointsRanking($limit)`ï¼šè·å–æ€»ç§¯åˆ†æ’è¡Œæ¦œ
- `getMonthlyPointsRanking($year, $month, $limit)`ï¼šè·å–æœˆåº¦ç§¯åˆ†æ’è¡Œæ¦œ
- `getInviteRanking($limit)`ï¼šè·å–é‚€è¯·äººæ•°æ’è¡Œæ¦œ
- `getPhotoCountRanking($limit)`ï¼šè·å–ä¸Šä¼ ç…§ç‰‡æ•°æ’è¡Œæ¦œ

## âš™ï¸ é…ç½®è¯´æ˜

### ç§¯åˆ†é…ç½®

åœ¨`system_config`è¡¨ä¸­é…ç½®ï¼ˆé€šè¿‡`Helper::getConfigGroup('points')`è·å–ï¼‰ï¼š

- `points_register_reward`ï¼šæ³¨å†Œå¥–åŠ±ç§¯åˆ†ï¼ˆé»˜è®¤10ï¼‰
- `points_invite_reward`ï¼šé‚€è¯·æ–°ç”¨æˆ·æ³¨å†Œå¥–åŠ±ï¼ˆé‚€è¯·äººï¼Œé»˜è®¤5ï¼‰
- `points_invite_new_user_reward`ï¼šé€šè¿‡é‚€è¯·ç æ³¨å†Œå¥–åŠ±ï¼ˆæ–°ç”¨æˆ·ï¼Œé»˜è®¤5ï¼‰
- `points_upload_reward`ï¼šä¸Šä¼ ç…§ç‰‡/è§†é¢‘å¥–åŠ±ï¼ˆé»˜è®¤2ï¼‰
- `points_checkin_reward`ï¼šæ¯æ—¥ç­¾åˆ°åŸºç¡€å¥–åŠ±ï¼ˆé»˜è®¤5ï¼‰
- `points_checkin_vip_bonus`ï¼šVIPç”¨æˆ·ç­¾åˆ°é¢å¤–å¥–åŠ±ï¼ˆé»˜è®¤3ï¼‰
- `points_checkin_consecutive_bonus`ï¼šæ™®é€šç”¨æˆ·è¿ç»­ç­¾åˆ°å¥–åŠ±ï¼ˆJSONæ ¼å¼ï¼š{"3": 5, "7": 10, "15": 20, "30": 50}ï¼‰
- `points_checkin_vip_consecutive_bonus`ï¼šVIPç”¨æˆ·è¿ç»­ç­¾åˆ°å¥–åŠ±ï¼ˆJSONæ ¼å¼ï¼š{"3": 8, "7": 15, "15": 30, "30": 80}ï¼‰

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç­¾åˆ°æµç¨‹

```php
// 1. æ£€æŸ¥ç­¾åˆ°çŠ¶æ€
// GET /api/check_checkin_status.php

// 2. æ‰§è¡Œç­¾åˆ°
// POST /api/do_checkin.php

// 3. ç³»ç»Ÿè®¡ç®—ç§¯åˆ†
// - åŸºç¡€ç§¯åˆ†
// - VIPé¢å¤–å¥–åŠ±ï¼ˆå¦‚æœæ˜¯VIPï¼‰
// - è¿ç»­ç­¾åˆ°å¥–åŠ±ï¼ˆå¦‚æœæ»¡è¶³æ¡ä»¶ï¼‰
// - æ›´æ–°ç”¨æˆ·ç§¯åˆ†
// - è®°å½•ç­¾åˆ°å’Œç§¯åˆ†å˜åŠ¨
```

### æŸ¥çœ‹ç§¯åˆ†æ˜ç»†

```php
// GET /api/get_points.php?page=1&page_size=20
// è¿”å›ç§¯åˆ†æ€»é¢å’Œç§¯åˆ†å˜åŠ¨æ˜ç»†
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **è¿ç»­ç­¾åˆ°**ï¼šä¸­æ–­åé‡æ–°å¼€å§‹è®¡ç®—
2. **ç§¯åˆ†è®°å½•**ï¼šæ‰€æœ‰ç§¯åˆ†å˜åŠ¨éƒ½æœ‰è¯¦ç»†è®°å½•
3. **æ’è¡Œæ¦œæ›´æ–°**ï¼šæ’è¡Œæ¦œå®æ—¶è®¡ç®—ï¼Œä¸ç¼“å­˜
4. **ç§¯åˆ†æ¶ˆè´¹**ï¼šç§¯åˆ†ä¸èƒ½ä¸ºè´Ÿæ•°
5. **ç­¾åˆ°é™åˆ¶**ï¼šæ¯æ—¥åªèƒ½ç­¾åˆ°ä¸€æ¬¡

