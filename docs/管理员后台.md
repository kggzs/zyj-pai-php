# 🔧 管理员后台模块

管理员后台模块提供完整的管理功能，包括用户管理、照片管理、数据统计、系统配置等。

## ✨ 功能概述

### 👥 1. 用户管理

#### 用户列表
- 查看所有用户列表（分页）
- 支持搜索（用户名、昵称、邮箱、IP、注册码、拍摄链接码）
- 显示用户详细信息

#### 用户操作
- **查看用户详情**：查看用户的完整信息
- **封禁/解封用户**：封禁或解封用户账号
- **设置VIP**：为用户设置VIP（临时或永久）
- **调整积分**：增加或减少用户积分
- **查看用户照片**：查看用户上传的所有照片
- **查看登录日志**：查看用户的登录记录
- **查看积分明细**：查看用户的积分变动记录

### 📸 2. 照片管理

#### 照片列表
- 查看所有用户上传的照片/视频（分页）
- 支持筛选（用户ID、用户名、拍摄链接码）
- 显示照片详细信息（包括EXIF数据）

#### 照片操作
- **查看照片详情**：查看照片的完整信息
- **删除照片**：硬删除照片（删除文件）

### 📊 3. 数据统计

#### 统计数据
- **用户统计**：总用户数、VIP用户数、封禁用户数
- **照片统计**：总照片数、视频数
- **积分统计**：总积分、平均积分
- **上传趋势**：最近7天的上传趋势
- **注册趋势**：最近7天的注册趋势
- **浏览器统计**：按浏览器类型统计上传数量

### ⚙️ 4. 系统配置

#### 配置管理
- **积分配置**：配置各种积分奖励
- **拍摄链接配置**：配置拍摄链接相关参数
- **邮件配置**：配置SMTP邮件服务器
- **其他配置**：系统其他配置项

#### 配置组
- 配置按组管理（points、invite、email等）
- 支持配置的增删改查

### 📢 5. 公告管理

- **发布公告**：创建系统公告
- **编辑公告**：修改公告内容
- **删除公告**：删除公告
- **查看阅读状态**：查看公告的阅读情况

### 🛒 6. 积分商城管理

- **添加商品**：添加新商品
- **编辑商品**：修改商品信息
- **删除商品**：删除商品（有兑换记录时只能下架）
- **上架/下架**：控制商品状态

### 📋 7. 日志管理

#### 登录日志
- 查看所有用户的登录日志
- 支持搜索和筛选

#### 管理员操作日志
- 记录管理员的所有操作
- 包括操作类型、操作对象、操作时间等

#### 异常行为日志
- 记录系统的异常行为
- 包括异常类型、严重程度、详细信息等

#### 系统错误日志
- 记录系统错误信息
- 包括错误类型、错误信息、堆栈等

### 💾 8. 缓存管理

- **清除缓存**：清除系统缓存
- 缓存用于提高性能（统计数据等）

## 🔌 API接口

管理员API接口位于`api/admin/`目录下，主要包括：

- `get_users.php`：获取用户列表
- `get_user_detail.php`：获取用户详情
- `ban_user.php`：封禁/解封用户
- `set_vip.php`：设置VIP
- `adjust_points.php`：调整积分
- `get_all_photos.php`：获取所有照片
- `get_photo_detail.php`：获取照片详情
- `delete_photo.php`：删除照片
- `get_statistics.php`：获取统计数据
- `get_config.php`：获取配置
- `save_config.php`：保存配置
- `set_system_config.php`：设置系统配置
- `create_announcement.php`：创建公告
- `update_announcement.php`：更新公告
- `delete_announcement.php`：删除公告
- `get_announcement_detail.php`：获取公告详情
- `get_announcement_read_status.php`：获取公告阅读状态
- `add_shop_product.php`：添加商品
- `update_shop_product.php`：更新商品
- `delete_shop_product.php`：删除商品
- `toggle_shop_product_status.php`：切换商品状态
- `get_user_login_logs.php`：获取用户登录日志
- `get_admin_operation_logs.php`：获取管理员操作日志
- `get_abnormal_behavior_logs.php`：获取异常行为日志
- `get_system_error_logs.php`：获取系统错误日志
- `clear_cache.php`：清除缓存

## 🗄️ 数据库结构

管理员功能使用现有的数据库表，主要涉及：

- `users`：用户表
- `photos`：照片表
- `points_log`：积分变动表
- `checkins`：签到记录表
- `invites`：拍摄链接表
- `announcements`：公告表
- `points_shop`：商品表
- `login_logs`：登录日志表
- `admin_operation_logs`：管理员操作日志表
- `abnormal_behavior_logs`：异常行为日志表
- `system_error_logs`：系统错误日志表
- `system_config`：系统配置表

## 🧰 核心类

### Admin类

位置：`core/Admin.php`

主要方法：
- `login($username, $password)`：管理员登录
- `isLoggedIn()`：检查是否已登录
- `getUserList($page, $pageSize, $search)`：获取用户列表
- `getUserDetail($userId)`：获取用户详情
- `banUser($userId, $status)`：封禁/解封用户
- `setVip($userId, $days, $isPermanent)`：设置VIP
- `adjustUserPoints($userId, $points, $remark)`：调整积分
- `getAllPhotos($page, $pageSize, $userId, $username, $inviteCode)`：获取所有照片
- `getStatistics()`：获取统计数据
- `getConfig($key)`：获取配置
- `saveConfig($key, $value)`：保存配置
- `setConfigGroup($groupName, $configData)`：设置配置组
- `logAbnormalBehavior(...)`：记录异常行为
- `logAdminOperation(...)`：记录管理员操作

## 📝 使用示例

### 管理员登录

```php
// 访问 /admin_login.php
// 使用管理员账号登录
// 登录成功后访问 /admin.php
```

### 用户管理

```php
// 1. 获取用户列表
// GET /api/admin/get_users.php?page=1&page_size=20&search=关键词

// 2. 查看用户详情
// GET /api/admin/get_user_detail.php?user_id=123

// 3. 封禁用户
// POST /api/admin/ban_user.php
// {
//   "user_id": 123,
//   "status": 0
// }

// 4. 设置VIP
// POST /api/admin/set_vip.php
// {
//   "user_id": 123,
//   "days": 30,
//   "is_permanent": false
// }
```

### 数据统计

```php
// GET /api/admin/get_statistics.php
// 返回各种统计数据
```

## ⚠️ 注意事项

1. **权限验证**：所有管理员API都需要验证管理员权限
2. **操作日志**：管理员的重要操作都会记录日志
3. **数据安全**：删除操作要谨慎，照片删除会删除文件
4. **配置管理**：修改系统配置可能影响系统运行
5. **缓存管理**：清除缓存后统计数据会重新计算

