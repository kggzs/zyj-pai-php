# 📢 系统公告模块

系统公告模块负责系统公告的发布、管理和阅读状态跟踪。

## ✨ 功能概述

### 🔔 1. 公告类型

- **重要公告**（`important`）：重要公告，高优先级
- **普通公告**（`normal`）：普通公告
- **通知公告**（`notice`）：通知公告

### ⚙️ 2. 公告管理

#### 公告属性
- 公告标题
- 公告内容（支持纯文本、HTML、Markdown）
- 公告级别（important、normal、notice）
- 是否强制已读（require_read）
- 是否显示（is_visible）
- 发布管理员

#### 公告状态
- **显示**（is_visible = 1）：用户可以看到
- **隐藏**（is_visible = 0）：用户不能看到

#### 强制已读
- 如果设置了强制已读，系统会为所有用户创建未读记录
- 用户必须阅读后才能标记为已读

### 👀 3. 阅读状态跟踪

- 系统跟踪每个用户对公告的阅读状态
- 显示未读公告数量
- 支持标记公告为已读

## 🔌 API接口

### 获取公告列表

**接口**：`GET /api/get_announcements.php`

**权限**：可选（未登录用户只能看到不强制已读的公告）

**参数**：
- `page`（可选）：页码（默认1）
- `page_size`（可选）：每页数量（默认20）

**返回示例**：
```json
{
  "success": true,
  "list": [
    {
      "id": 1,
      "title": "系统维护公告",
      "content": "系统将在...",
      "level": "important",
      "create_time": "2024-01-08 12:00:00",
      "is_read": false
    }
  ],
  "total": 10,
  "unread_count": 3
}
```

### 标记公告已读

**接口**：`POST /api/mark_announcement_read.php`

**权限**：需要登录

**参数**：
- `announcement_id`（必填）：公告ID

## 🗄️ 数据库结构

### announcements表

公告表：
- `id`：公告ID（主键）
- `title`：公告标题
- `content`：公告内容
- `content_type`：内容类型（"plain"、"html"、"markdown"、"auto"）
- `level`：公告级别（"important"、"normal"、"notice"）
- `require_read`：是否强制已读（0否，1是）
- `is_visible`：是否显示（0否，1是）
- `admin_id`：发布管理员ID
- `create_time`：创建时间
- `update_time`：更新时间

### user_announcements表

用户公告阅读记录表：
- `id`：记录ID（主键）
- `user_id`：用户ID
- `announcement_id`：公告ID
- `is_read`：是否已读（0未读，1已读）
- `read_time`：阅读时间

## 🧰 核心类

### Announcement类

位置：`core/Announcement.php`

主要方法：
- `getAnnouncements($userId, $page, $pageSize)`：获取公告列表
- `markAsRead($userId, $announcementId)`：标记公告已读
- `createAnnouncement(...)`：创建公告（管理员）
- `updateAnnouncement(...)`：更新公告（管理员）
- `deleteAnnouncement($announcementId)`：删除公告（管理员）

## 📝 使用示例

### 发布公告（管理员）

```php
// 管理员在后台发布公告
// 设置公告标题、内容、级别等
// 如果设置了强制已读，系统会为所有用户创建未读记录
```

### 查看公告（用户）

```php
// 1. 获取公告列表
// GET /api/get_announcements.php

// 2. 查看公告详情
// 前端显示公告内容

// 3. 标记已读（如果强制已读）
// POST /api/mark_announcement_read.php
// {
//   "announcement_id": 1
// }
```

## ⚠️ 注意事项

1. **强制已读**：如果设置了强制已读，系统会跟踪阅读状态
2. **公告显示**：只有显示的公告用户才能看到
3. **未读数量**：系统会统计未读公告数量
4. **内容类型**：支持多种内容格式（纯文本、HTML、Markdown）

